---
title: Model comparisons
author: Masatoshi Katabuchi
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
#rmdformats::material
  html_document:
    fig_caption: yes
    theme: spacelab #readable #sandstone #spacelab #flatly
    highlight: pygments #tango #kate
    toc: TRUE
    toc_depth: 2
    number_sections: TRUE
    toc_float:
      collapsed: TRUE
      smooth_scroll: TRUE
      toc: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE,
                      warning=FALSE,
                      cache=FALSE,
                      message=FALSE)
```

```{r, include=FALSE}
library(tidyverse)
library(kableExtra)
```

```{r}
GL_tb <- read_csv("../data/GL_elpd.csv")
PA_tb <- read_csv("../data/PA_elpd.csv")
```

Constraing alpha_s < 0 and beta_p < 0 did not work very well.
Instead, I used alpha_s < alpha_p and  beta_p < beta_s.
I also considerd LAMp or LMAs only models (alpha_s = 0 or beta_p = 0).

# GLOPNET

- alpha_s : if we use alpha_s in the model
- beta_p : if we use alpha_s in the model

Best model:
$$
A = \alpha_0 LMAp^{\alpha_p}LMAs^{\alpha_s}
$$
$$
LL = \beta_0 LMAs^{\beta_s}
$$

```{r}
GL_tb |>
  rename(model = LMA) |>
  mutate(data = "GLOPNET") |>
  mutate(looic = round(looic, 1)) |>
  mutate(lp = round(lp, 1)) |>
  mutate(alpha_s = ifelse(str_detect(model, "Aps"), "YES", "-")) |>
  mutate(beta_p = ifelse(str_detect(model, "L.ps"), "YES", "-")) |>
  mutate(model2 = case_when(
    str_detect(model, "LL") ~ "LMAp + LMAs",
    TRUE ~ "LMA"
  )) |>
  dplyr::select(model, model2, looic, lp, N, alpha_s, beta_p) |>
  kable(format = "html") |>
  kable_styling()
```

# Panama

- theta: if we use theta (effect of light) in the model
- LD: if we use leaf density instead of LMAs to model LL

Best model:
$$
A = \alpha_0 LMAp^{\alpha_p}LMAs^{\alpha_s}
$$
$$
LL = \beta_0 LMAs^{\beta_s} exp(\theta Light)
$$


```{r}
PA_tb |>
  rename(model = LMA) |>
  filter(!str_detect(model, "more")) |>
  mutate(data = "Panama") |>
  mutate(looic = round(looic, 1)) |>
  mutate(lp = round(lp, 1)) |>
  mutate(alpha_s = ifelse(str_detect(model, "Aps"), "YES", "-")) |>
  mutate(beta_p = ifelse(str_detect(model, "L.ps"), "YES", "-"))  |>
  mutate(theta = ifelse(str_detect(model, "opt"), "YES", "-"))  |>
  mutate(LD = ifelse(str_detect(model, "LD"), "YES", "-")) |>
  mutate(model2 = case_when(
    str_detect(model, "LD") ~ "LMAp + LMAs/LT",
    str_detect(model, "LL") ~ "LMAp + LMAs",
    TRUE ~ "LMA"
  )) |>
  mutate(model3 = ifelse(str_detect(model, "opt"), paste0(model2, " + Light"), model2)) |>
  dplyr::select(model, model2 = model3, looic, lp, N, alpha_s, beta_p, theta, LD) |>
  kable(format = "html") |>
  kable_styling()
```
